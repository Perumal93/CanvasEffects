"undefined"===typeof Uint8ClampedArray&&(Uint8ClampedArray=Uint8Array);
var w,h,fx={convolute:function(a,g,b,c){c=c||!0;var j=Math.round(Math.sqrt(g.length)),u=Math.floor(j/2),v=w,x=h,f=new Uint8ClampedArray(a.length);c=c?1:0;for(var k=0;k<h;k++)for(var l=0;l<w;l++){for(var y=k,z=l,m=4*(k*w+l),r=0,s=0,t=0,n=0,p=0;p<j;p++)for(var q=0;q<j;q++){var d=y+p-u,e=z+q-u;0<=d&&(d<x&&0<=e&&e<v)&&(d=4*(d*v+e),e=g[p*j+q],r+=a[d]*e,s+=a[d+1]*e,t+=a[d+2]*e,n+=a[d+3]*e)}f[m]=b+r;f[m+1]=b+s;f[m+2]=b+t;f[m+3]=n+c*(255-n)}return f},process:function(a,g){for(var b=0;b<a.length;b+=4){var c=
g(a[b],a[b+1],a[b+2],a[b+3]);a[b]=c[b];a[b+1]=c[b+1];a[b+2]=c[b+2];a[b+3]=c[b+3]}return a}};this.onmessage=function(a){a=a.data;switch(a.type){case "init":w=a.w;h=a.h;break;case "convolute":this.postMessage(fx.convolute(a.data,a.matrix,a.offset,a.opaque));break;case "process":this.postMessage(fx.process(a.data,a.func))}};