(function(u,k){u.CanvasEffects=function(l){this.processCanvas=l=l||k.createElement("canvas");this.processCtx=this.processCanvas.getContext("2d");this.tmpCanvas=k.createElement("canvas");this.tmpCtx=this.tmpCanvas.getContext("2d");this.getContext=function(){return this.processCtx};this.luminance=function(d,c,a){return 0.2126*d+0.7152*c+0.0722*a};this.createImageData=function(d,c){return this.tmpCtx.createImageData(d,c)};this.rgbToHsl=function(d,c,a){var d=d/255,c=c/255,a=a/255,b=Math.max(d,c,a),g=
Math.min(d,c,a),e,f=(b+g)/2;if(b==g)e=g=0;else{var h=b-g,g=0.5<f?h/(2-b-g):h/(b+g);switch(b){case d:e=(c-a)/h+(c<a?6:0);break;case c:e=(a-d)/h+2;break;case a:e=(d-c)/h+4}}return[e/6,g,f]};this.hslToRgb=function(d,c,a){if(0==c)a=c=d=a;else var b=function(a,b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*c:0.5>c?b:c<2/3?a+6*(b-a)*(2/3-c):a},g=0.5>a?a*(1+c):a+c-a*c,e=2*a-g,a=b(e,g,d+1/3),c=b(e,g,d),d=b(e,g,d-1/3);return[255*a,255*c,255*d]};this.convolute=function(d,c,a){for(var b=this.processCtx.getImageData(0,
0,this.processCanvas.width,this.processCanvas.height),g=Math.round(Math.sqrt(d.length)),e=Math.floor(g/2),f=b.data,h=b.width,b=b.height,k=this.createImageData(h,b),m=k.data,a=a?1:0,n=0;n<b;n++)for(var p=0;p<h;p++){for(var l=n,u=p,q=4*(n*h+p),v=0,w=0,x=0,r=0,s=0;s<g;s++)for(var t=0;t<g;t++){var i=l+s-e,j=u+t-e;0<=i&&(i<b&&0<=j&&j<h)&&(i=4*(i*h+j),j=d[s*g+t],v+=f[i]*j,w+=f[i+1]*j,x+=f[i+2]*j,r+=f[i+3]*j)}m[q]=c+v;m[q+1]=c+w;m[q+2]=c+x;m[q+3]=r+a*(255-r)}this.processCtx.clearRect(0,0,this.processCanvas.width,
this.processCanvas.height);this.processCtx.putImageData(k,0,0);return this};this.sepia=function(d){for(var d=Math.min(d?d:1,1),d=255*d,c=this.processCtx.getImageData(0,0,this.processCanvas.width,this.processCanvas.height),a=c.data,b=0;b<a.length;b+=4)a[b]=0.393*a[b]+0.769*a[b+1]+0.189*a[b+2],a[b+1]=0.349*a[b]+0.686*a[b+1]+0.168*a[b+2],a[b+2]=0.272*a[b]+0.534*a[b+1]+0.131*a[b+2],a[b+3]=d;c.data=a;this.processCtx.putImageData(c,0,0);return this};this.greyscale=function(){for(var d=this.processCtx.getImageData(0,
0,this.processCanvas.width,this.processCanvas.height),c=d.data,a=0;a<c.length;a+=4)c[a]=c[a+1]=c[a+2]=this.luminance(c[a],c[a+1],c[a+2]);d.data=c;this.processCtx.putImageData(d,0,0);return this};this.invert=function(){for(var d=this.processCtx.getImageData(0,0,this.processCanvas.width,this.processCanvas.height),c=d.data,a=0;a<c.length;a+=4)c[a]=255-c[a],c[a+1]=255-c[a+2],c[a+2]=255-c[a+2];d.data=c;this.processCtx.putImageData(d,0,0);return this};this.hue=function(d,c){for(var a=this.processCtx.getImageData(0,
0,this.processCanvas.width,this.processCanvas.height),b=a.data,g=d/360,e=0;e<b.length;e+=4){var f=this.rgbToHsl(b[e],b[e+1],b[e+2]);f[0]=c?g:f[0]+g;f=this.hslToRgb(f[0],f[1],f[2]);b[e]=f[0];b[e+1]=f[1];b[e+2]=f[2]}a.data=b;this.processCtx.putImageData(a,0,0);return this};this.saturation=function(d,c){for(var a=this.processCtx.getImageData(0,0,this.processCanvas.width,this.processCanvas.height),b=a.data,g=d/100,e=0;e<b.length;e+=4){var f=this.rgbToHsl(b[e],b[e+1],b[e+2]);f[1]=c?g:f[1]+g;f=this.hslToRgb(f[0],
f[1],f[2]);b[e]=f[0];b[e+1]=f[1];b[e+2]=f[2]}a.data=b;this.processCtx.putImageData(a,0,0);return this};this.lightness=function(d,c){for(var a=this.processCtx.getImageData(0,0,this.processCanvas.width,this.processCanvas.height),b=a.data,g=d/100,e=0;e<b.length;e+=4){var f=this.rgbToHsl(b[e],b[e+1],b[e+2]);f[2]=c?g:f[2]+g;f=this.hslToRgb(f[0],f[1],f[2]);b[e]=f[0];b[e+1]=f[1];b[e+2]=f[2]}a.data=b;this.processCtx.putImageData(a,0,0);return this};this.findEdges=function(){this.convolute([-1,0,1,-2,0,2,
-1,0,1],0,!0);return this};this.emboss=function(){this.convolute([2,0,0,0,-1,0,0,0,-1],127,!0);return this};this.blur=function(){this.convolute([1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],0,!0);return this};this.sharpen=function(){this.convolute([0,-1,0,-1,5,-1,0,-1,0],0,!0);return this};this.highlightEdges=function(){this.convolute([0.5,1,0.5,1,-5,1,0.5,1,0.5],0,!0);return this}}})(window,document);